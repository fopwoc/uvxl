name: Build

on:
  push:
    branches:
      - 'mistress'
    tags:
      - '*'
    paths-ignore:
      - '*.md'

env:
  package-client: |
    { 
      name: "client",
      binary: "${{ github.event.repository.name }}",
      path: "./" 
    }
  package-server: |
    { 
      name: "server",
      binary: "${{ github.event.repository.name }}-server",
      path: "./${{ github.event.repository.name }}-server" 
    }

jobs:
  check-client:
    uses: ./.github/workflows/check.yml
    with:
      name: "client"
      binary: "${{ github.event.repository.name }}"
      path: "./" 
  check-server:
    uses: ./.github/workflows/check.yml
    with:
      name: "server"
      binary: "${{ github.event.repository.name }}-server"
      path: "./${{ github.event.repository.name }}-server"
  build-client:
    needs: [check-client, check-server]
    uses: ./.github/workflows/build.yml
    with:
      name: "client"
      binary: "${{ github.event.repository.name }}"
      path: "./" 
  build-server:
    needs: [check-client, check-server]
    uses: ./.github/workflows/build.yml
    with:
      name: "server"
      binary: "${{ github.event.repository.name }}-server"
      path: "./${{ github.event.repository.name }}-server"
  build_wasm:
    needs: [check-client, check-server]
    uses: ./.github/workflows/build-wasm.yml
    with:
      name: "client"
      binary: "${{ github.event.repository.name }}"
      path: "./" 
