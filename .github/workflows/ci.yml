name: Build

on:
  push:
    branches:
      - 'mistress'
    tags:
      - '*'
    paths-ignore:
      - '*.md'

jobs:
  check:
    uses: ./.github/workflows/check.yml
    strategy:
      matrix:
        include:
          - name: "client"
            binary: "${{ github.event.repository.name }}"
            path: "./"
          - name: "server"
            binary: "${{ github.event.repository.name }}-server"
            path: "./${{ github.event.repository.name }}-server"
    with:
      name: ${{ matrix.name }}
      binary: ${{ matrix.binary }}
      path: ${{ matrix.path }}
  build:
    needs: check
    uses: ./.github/workflows/build.yml
    strategy:
      matrix:
        include:
          - name: "client"
            binary: "${{ github.event.repository.name }}"
            path: "./"
          - name: "server"
            binary: "${{ github.event.repository.name }}-server"
            path: "./${{ github.event.repository.name }}-server"
    with:
      name: ${{ matrix.name }}
      binary: ${{ matrix.binary }}
      path: ${{ matrix.path }}
  build_wasm:
    needs: check
    uses: ./.github/workflows/build-wasm.yml
    strategy:
      matrix:
        include:
          - name: "client"
            binary: "${{ github.event.repository.name }}"
            path: "./"
    with:
      name: ${{ matrix.name }}
      binary: ${{ matrix.binary }}
      path: ${{ matrix.path }}
